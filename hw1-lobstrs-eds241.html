<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="EDS 241 / ESM 244 (Due: 1/17)">
<meta name="dcterms.date" content="2026-01-08">

<title>Assignment 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="hw1-lobstrs-eds241_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw1-lobstrs-eds241_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="hw1-lobstrs-eds241_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="hw1-lobstrs-eds241_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="hw1-lobstrs-eds241_files/libs/quarto-html/popper.min.js"></script>
<script src="hw1-lobstrs-eds241_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw1-lobstrs-eds241_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw1-lobstrs-eds241_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw1-lobstrs-eds241_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw1-lobstrs-eds241_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw1-lobstrs-eds241_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw1-lobstrs-eds241_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assignment 1</h1>
<p class="subtitle lead">California Spiny Lobster (<em>Panulirus Interruptus</em>): Assessing the Impact of Marine Protected Areas (MPAs) at 5 Reef Sites in Santa Barbara County</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>EDS 241 / ESM 244 (<strong>Due: 1/17</strong>) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 8, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<hr>
<p><img src="figures/spiny2.jpg" class="img-fluid"></p>
<hr>
<section id="assignment-instructions" class="level3">
<h3 class="anchored" data-anchor-id="assignment-instructions">Assignment Instructions:</h3>
<ul>
<li><p>Working with partners to troubleshoot code and concepts is encouraged! If you work with a partner, please list their name next to yours at the top of your assignment so Annie and I can easily see who collaborated.</p></li>
<li><p>All written responses must be written independently (<strong>in your own words</strong>).</p></li>
<li><p>Please follow the question prompts carefully and include only the information each question asks in your submitted responses.</p></li>
<li><p>Submit both your knitted document and the associated <code>RMarkdown</code> or <code>Quarto</code> file.</p></li>
<li><p>Your knitted presentation should meet the quality you‚Äôd submit to research colleagues or feel confident sharing publicly. Refer to the rubric for details about presentation standards.</p></li>
</ul>
<p><strong>Assignment submission (YOUR NAME):</strong> Zach Loo</p>
<hr>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(estimatr)  </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(interactions) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggridges)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<section id="data-source" class="level4">
<h4 class="anchored" data-anchor-id="data-source">DATA SOURCE:</h4>
<blockquote class="blockquote">
<p><a href="https://doi.org/10.6073/pasta/a593a675d644fdefb736750b291579a0">Reed D. 2019. SBC LTER: Reef: Abundance, size and fishing effort for California Spiny Lobster (Panulirus interruptus), ongoing since 2012. Environmental Data Initiative.</a> Data accessed 11/17/2019.</p>
</blockquote>
<hr>
</section>
</section>
<section id="introduction" class="level3">
<h3 class="anchored" data-anchor-id="introduction"><strong>Introduction</strong></h3>
<p>You‚Äôre about to dive into some deep data collected from five reef sites in Santa Barbara County, all about the abundance of California spiny lobsters! ü¶û Data was gathered by divers annually from 2012 to 2018 across Naples, Mohawk, Isla Vista, Carpinteria, and Arroyo Quemado reefs.</p>
<p>Why lobsters? Well, this sample provides an opportunity to evaluate the impact of Marine Protected Areas (MPAs) established on January 1, 2012 (Reed, 2019). Of these five reefs, Naples, and Isla Vista are MPAs, while the other three are not protected (non-MPAs). Comparing lobster health between these protected and non-protected areas gives us the chance to study how commercial and recreational fishing might impact these ecosystems.</p>
<p>We will consider the MPA sites the <code>treatment</code> group and use regression methods to explore whether protecting these reefs really makes a difference compared to non-MPA sites (our control group). In this assignment, we‚Äôll think deeply about which causal inference assumptions hold up under the research design and identify where they fall short.</p>
<p>Let‚Äôs break it down step by step and see what the data reveals! üìä</p>
<p><img src="figures/map-5reefs.png" class="img-fluid"></p>
<hr>
<section id="step-1-anticipating-potential-sources-of-selection-bias" class="level4">
<h4 class="anchored" data-anchor-id="step-1-anticipating-potential-sources-of-selection-bias">Step 1: Anticipating potential sources of selection bias</h4>
<p><strong>a.</strong> Do the control sites (Arroyo Quemado, Carpenteria, and Mohawk) provide a strong counterfactual for our treatment sites (Naples, Isla Vista)? Write a paragraph making a case for why this comparison is ceteris paribus or whether selection bias is likely (be specific!).</p>
<p>To analyze the causal effect of MPAs on lobster abundance, we need these study sites to be ‚Äúequal‚Äù in every way besides MPA status. This could be done if policymakers flipped a coin to assign protection status at each of these sites, essentially assigning at random. This randomness would ideally make the sites statistically identical on average and we could observe the differences after MPA treatment. To my knowledge, I‚Äôm not sure how these sites were assigned to be treated or not but usually in policymaking, assigning treatment as random isn‚Äôt likely. Instead, if sites that were already degraded were assigned as the treatment, this would be assignment based on an unobservable factor, making selection bias a worry.</p>
<hr>
</section>
<section id="step-2-read-wrangle-data" class="level4">
<h4 class="anchored" data-anchor-id="step-2-read-wrangle-data">Step 2: Read &amp; wrangle data</h4>
<p><strong>a.</strong> Read in the raw data from the ‚Äúdata‚Äù folder named <code>spiny_abundance_sb_18.csv</code>. Name the data.frame <code>rawdata</code></p>
<p><strong>b.</strong> Use the function <code>clean_names()</code> from the <code>janitor</code> package</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HINT: check for coding of missing values (`na = "-99999"`)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>rawdata <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"spiny_abundance_sb_18.csv"</span>), <span class="at">na =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">99999</span>, <span class="st">"NA"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><strong>c.</strong> Create a new <code>df</code> named <code>tidydata</code>. Using the variable <code>site</code> (reef location) create a new variable <code>reef</code> as a <code>factor</code> and add the following labels in the order listed (i.e., re-order the <code>levels</code>):</p>
<pre><code>"Arroyo Quemado", "Carpenteria", "Mohawk", "Isla Vista",  "Naples"</code></pre>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>tidydata <span class="ot">&lt;-</span> rawdata <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">reef =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        site <span class="sc">==</span> <span class="st">"IVEE"</span> <span class="sc">~</span> <span class="st">"Isla Vista"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        site <span class="sc">==</span> <span class="st">"NAPL"</span> <span class="sc">~</span> <span class="st">"Naples"</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        site <span class="sc">==</span> <span class="st">"AQUE"</span> <span class="sc">~</span> <span class="st">"Arroyo Quemado"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        site <span class="sc">==</span> <span class="st">"CARP"</span> <span class="sc">~</span> <span class="st">"Carpenteria"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        site <span class="sc">==</span> <span class="st">"MOHK"</span> <span class="sc">~</span> <span class="st">"Mohawk"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span> </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">factor</span>(reef, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Arroyo Quemado"</span>, <span class="st">"Carpenteria"</span>, <span class="st">"Mohawk"</span>, <span class="st">"Isla Vista"</span>,  <span class="st">"Naples"</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Create new <code>df</code> named <code>spiny_counts</code></p>
<p><strong>d.</strong> Create a new variable <code>counts</code> to allow for an analysis of lobster counts where the unit-level of observation is the total number of observed lobsters per <code>site</code>, <code>year</code> and <code>transect</code>.</p>
<ul>
<li>Create a variable <code>mean_size</code> from the variable <code>size_mm</code></li>
<li>NOTE: The variable <code>counts</code> should have values which are integers (whole numbers).</li>
<li>Make sure to account for missing cases (<code>na</code>)!</li>
</ul>
<p><strong>e.</strong> Create a new variable <code>mpa</code> with levels <code>MPA</code> and <code>non_MPA</code>. For our regression analysis create a numerical variable <code>treat</code> where MPA sites are coded <code>1</code> and non_MPA sites are coded <code>0</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#HINT(d): Use `group_by()` &amp; `summarize()` to provide the total number of lobsters observed at each site-year-transect row-observation. </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>spiny_counts <span class="ot">&lt;-</span> tidydata <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(site, year, transect) <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">counts =</span> <span class="fu">sum</span>(count, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">mean_size_mm =</span> <span class="fu">mean</span>(size_mm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#HINT(e): Use `case_when()` to create the 3 new variable columns</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>spiny_counts <span class="ot">&lt;-</span> spiny_counts <span class="sc">|&gt;</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mpa =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IVEE"</span>, <span class="st">"NAPL"</span>) <span class="sc">~</span> <span class="st">"MPA"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        site <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MOHK"</span>, <span class="st">"CARP"</span>, <span class="st">"AQUE"</span>) <span class="sc">~</span> <span class="st">"non_MPA"</span>),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">treat =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            mpa <span class="sc">==</span> <span class="st">"MPA"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            mpa <span class="sc">==</span> <span class="st">"non_MPA"</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        ))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<blockquote class="blockquote">
<p>NOTE: This step is crucial to the analysis. Check with a friend or come to TA/instructor office hours to make sure the counts are coded correctly!</p>
</blockquote>
<hr>
</section>
<section id="step-3-explore-visualize-data" class="level4">
<h4 class="anchored" data-anchor-id="step-3-explore-visualize-data">Step 3: Explore &amp; visualize data</h4>
<p><strong>a.</strong> Take a look at the data! Get familiar with the data in each <code>df</code> format (<code>tidydata</code>, <code>spiny_counts</code>)</p>
<p><strong>b.</strong> We will focus on the variables <code>count</code>, <code>year</code>, <code>site</code>, and <code>treat</code>(<code>mpa</code>) to model lobster abundance. Create the following 4 plots using a different method each time from the 6 options provided. Add a layer (<code>geom</code>) to each of the plots including informative descriptive statistics (you choose; e.g., mean, median, SD, quartiles, range). Make sure each plot dimension is clearly labeled (e.g., axes, groups).</p>
<ul>
<li><a href="https://r-charts.com/distribution/density-plot-group-ggplot2">Density plot</a></li>
<li><a href="https://r-charts.com/distribution/ggridges/">Ridge plot</a></li>
<li><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">Jitter plot</a></li>
<li><a href="https://r-charts.com/distribution/violin-plot-group-ggplot2">Violin plot</a></li>
<li><a href="https://r-charts.com/distribution/histogram-density-ggplot2/">Histogram</a></li>
<li><a href="https://r-charts.com/distribution/beeswarm/">Beeswarm</a></li>
</ul>
<p>Create plots displaying the distribution of lobster <strong>counts</strong>:</p>
<ol type="1">
<li>grouped by reef site<br>
</li>
<li>grouped by MPA status</li>
<li>grouped by year</li>
</ol>
<p>Create a plot of lobster <strong>size</strong> :</p>
<ol start="4" type="1">
<li>You choose the grouping variable(s)!</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot1: Lobster counts by site</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spiny_counts, <span class="fu">aes</span>(<span class="at">x =</span> counts, <span class="at">y =</span> site, <span class="at">fill =</span> mpa)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>(<span class="at">quantile.linetype =</span> <span class="st">"solid"</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"MPA"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>, <span class="st">"non_MPA"</span> <span class="ot">=</span> <span class="st">"grey59"</span>)) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Lobster Count"</span>, <span class="at">y =</span> <span class="st">"Site"</span>, <span class="at">fill =</span> <span class="st">"MPA Status"</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot2: Lobster counts by mpa, means</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>spiny_counts <span class="ot">&lt;-</span> spiny_counts <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mpa =</span> <span class="fu">factor</span>(mpa, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"non_MPA"</span>, <span class="st">"MPA"</span>)))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> spiny_counts <span class="sc">|&gt;</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(mpa) <span class="sc">|&gt;</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(counts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spiny_counts, <span class="fu">aes</span>(<span class="at">x =</span> counts, <span class="at">y =</span> mpa)) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density_ridges2</span>(<span class="at">scale =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">data =</span> means, <span class="fu">aes</span>(<span class="at">x =</span> mean <span class="sc">+</span> <span class="dv">30</span>, <span class="at">y =</span> <span class="fu">as.numeric</span>(mpa) <span class="sc">+</span> <span class="fl">0.7</span>), <span class="at">label =</span> <span class="st">"Mean count"</span>) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="at">data =</span> means, <span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">xend =</span> mean, </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">as.numeric</span>(mpa), <span class="at">yend =</span> <span class="fu">as.numeric</span>(mpa) <span class="sc">+</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"red"</span>, </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Lobster Count"</span>, <span class="at">y =</span> <span class="st">"MPA Status"</span>) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot3: Lobster count density by year, range</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spiny_counts, <span class="fu">aes</span>(<span class="at">x =</span> counts, <span class="at">group =</span> <span class="fu">factor</span>(year), <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Lobster Counts"</span>, <span class="at">y =</span> <span class="st">"Density"</span>, <span class="at">color =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot 4: Average lobster size by mpa</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to histogram, range</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spiny_counts, <span class="fu">aes</span>(<span class="at">x =</span> mean_size_mm, <span class="at">fill =</span> mpa)) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"MPA"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>, <span class="st">"non_MPA"</span> <span class="ot">=</span> <span class="st">"grey59"</span>)) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mean Lobster Size (mm)"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">fill =</span> <span class="st">"MPA Status"</span>) <span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>c.</strong> Compare means of the outcome by treatment group. Using the <code>tbl_summary()</code> function from the package <a href="https://www.danieldsjoberg.com/gtsummary/articles/tbl_summary.html"><code>gt_summary</code></a></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># USE: gt_summary::tbl_summary()</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>spiny_counts <span class="sc">|&gt;</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tbl_summary</span>(<span class="at">by =</span> mpa, <span class="at">include =</span> <span class="fu">c</span>(counts, mean_size_mm),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(<span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{mean} ({sd})"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="dbxrxainpl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dbxrxainpl table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dbxrxainpl thead, #dbxrxainpl tbody, #dbxrxainpl tfoot, #dbxrxainpl tr, #dbxrxainpl td, #dbxrxainpl th {
  border-style: none;
}

#dbxrxainpl p {
  margin: 0;
  padding: 0;
}

#dbxrxainpl .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dbxrxainpl .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dbxrxainpl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dbxrxainpl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dbxrxainpl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dbxrxainpl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dbxrxainpl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dbxrxainpl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dbxrxainpl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dbxrxainpl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dbxrxainpl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dbxrxainpl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dbxrxainpl .gt_spanner_row {
  border-bottom-style: hidden;
}

#dbxrxainpl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dbxrxainpl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dbxrxainpl .gt_from_md > :first-child {
  margin-top: 0;
}

#dbxrxainpl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dbxrxainpl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dbxrxainpl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dbxrxainpl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dbxrxainpl .gt_row_group_first td {
  border-top-width: 2px;
}

#dbxrxainpl .gt_row_group_first th {
  border-top-width: 2px;
}

#dbxrxainpl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dbxrxainpl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dbxrxainpl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dbxrxainpl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dbxrxainpl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dbxrxainpl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dbxrxainpl .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dbxrxainpl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dbxrxainpl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dbxrxainpl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dbxrxainpl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dbxrxainpl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dbxrxainpl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dbxrxainpl .gt_left {
  text-align: left;
}

#dbxrxainpl .gt_center {
  text-align: center;
}

#dbxrxainpl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dbxrxainpl .gt_font_normal {
  font-weight: normal;
}

#dbxrxainpl .gt_font_bold {
  font-weight: bold;
}

#dbxrxainpl .gt_font_italic {
  font-style: italic;
}

#dbxrxainpl .gt_super {
  font-size: 65%;
}

#dbxrxainpl .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dbxrxainpl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dbxrxainpl .gt_indent_1 {
  text-indent: 5px;
}

#dbxrxainpl .gt_indent_2 {
  text-indent: 10px;
}

#dbxrxainpl .gt_indent_3 {
  text-indent: 15px;
}

#dbxrxainpl .gt_indent_4 {
  text-indent: 20px;
}

#dbxrxainpl .gt_indent_5 {
  text-indent: 25px;
}

#dbxrxainpl .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#dbxrxainpl div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>non_MPA</strong><br>
N = 133<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>MPA</strong><br>
N = 119<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">counts</td>
<td class="gt_row gt_center" headers="stat_1">23 (39)</td>
<td class="gt_row gt_center" headers="stat_2">28 (44)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">mean_size_mm</td>
<td class="gt_row gt_center" headers="stat_1">73 (7)</td>
<td class="gt_row gt_center" headers="stat_2">76 (7)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Unknown</td>
<td class="gt_row gt_center" headers="stat_1">15</td>
<td class="gt_row gt_center" headers="stat_2">12</td>
</tr>
</tbody><tfoot>
<tr class="gt_footnotes odd">
<td colspan="3" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> Mean (SD)</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<hr>
</section>
<section id="step-4-ols-regression--building-intuition" class="level4">
<h4 class="anchored" data-anchor-id="step-4-ols-regression--building-intuition">Step 4: OLS regression- building intuition</h4>
<p><strong>a.</strong> Start with a simple OLS estimator of lobster counts regressed on treatment. Use the function <code>summ()</code> from the <a href="https://jtools.jacob-long.com/"><code>jtools</code></a> package to print the OLS output</p>
<p><strong>b.</strong> Interpret the intercept &amp; predictor coefficients <em>in your own words</em>. Use full sentences and write your interpretation of the regression results to be as clear as possible to a non-academic audience.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: We will not evaluate/interpret model fit in this assignment (e.g., R-square)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>m1_ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(counts <span class="sc">~</span> treat, <span class="at">data =</span> spiny_counts)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(m1_ols, <span class="at">model.fit =</span> <span class="cn">FALSE</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Observations</td>
<td style="text-align: right;">252</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Dependent variable</td>
<td style="text-align: right;">counts</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Type</td>
<td style="text-align: right;">OLS linear regression</td>
</tr>
</tbody>
</table>
</div>
  
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Est.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S.E.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">t val.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">(Intercept)</td>
<td style="text-align: right;">22.73</td>
<td style="text-align: right;">3.57</td>
<td style="text-align: right;">6.36</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">treat</td>
<td style="text-align: right;">5.36</td>
<td style="text-align: right;">5.20</td>
<td style="text-align: right;">1.03</td>
<td style="text-align: right;">0.30</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> Standard errors: OLS</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>
</div>
</div>
</div>
<ul>
<li>The intercept coefficient of 22.73 represents the y-intercept when <code>treat</code> = 0. This indicates an expected value of 22.73 lobsters in a non-MPA zone. The <code>treat</code> coefficient of 5.36 represents on average, MPA zones has counts of 5.36 more lobsters. However, the <code>treat</code> coefficient is non-significant, meaning there isn‚Äôt sufficient evidence to say that MPAs have an effect on lobster counts.</li>
</ul>
<p><strong>c.</strong> Check the model assumptions using the <code>check_model</code> function from the <code>performance</code> package</p>
<p><strong>d.</strong> Explain the results of the 4 diagnostic plots. Why are we getting this result?</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(m1_ols,  <span class="at">check =</span> <span class="st">"qq"</span> )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The dots don‚Äôt fall along the green line, indicating the residuals are not normally distributed. This is likely because we have count data which is often not normally distributed and a different model is needed.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(m1_ols, <span class="at">check =</span> <span class="st">"normality"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similarly, this test checks the normality of residuals. The distribution of residuals does not follow the normal curve because of the nature of our count data.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(m1_ols, <span class="at">check =</span> <span class="st">"homogeneity"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The homogeneity plot does not follow a flat, horizontal shape. It is a U-like shape, indicating that the variance of residuals is not constant.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(m1_ols, <span class="at">check =</span> <span class="st">"pp_check"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The posterior predictive check also does not match up. Since this predicts data from our data and compares to our observed data distributions. These lines differ greatly, meaning this model does not fit our data well.</p>
<hr>
</section>
<section id="step-5-fitting-glms" class="level4">
<h4 class="anchored" data-anchor-id="step-5-fitting-glms">Step 5: Fitting GLMs</h4>
<p><strong>a.</strong> Estimate a Poisson regression model using the <code>glm()</code> function</p>
<p><strong>b.</strong> Interpret the predictor coefficient in your own words. Use full sentences and write your interpretation of the results to be as clear as possible to a non-academic audience.</p>
<p>In this Poisson model, the predictor coefficient is 0.21. This value is reported in the log scale because of our log link function so undoing the log gives <span class="math inline">\(e^{(0.21)} = 1.23\)</span>. Also because of this link function, the effects become multiplicative, so the expected count of the treatment group is 23% higher than the non-treatment.</p>
<p><strong>c.</strong> Explain the statistical concept of dispersion and overdispersion in the context of this model.</p>
<p>In statistics, dispersion is the spread or variability of our data. In our example with overdispersion, there‚Äôs too much variability in our lobster counts that Poisson can handle. In Poisson models, it is assumed that the variance = mean. Overdispersion means that our lobster counts‚Äô variance is actually greater than the mean and that a better model could be fit.</p>
<p><strong>d.</strong> Compare results with previous model, explain change in the significance of the treatment effect</p>
<p>Our new model‚Äôs treatment effect indeed has a lower p-val and it is significant compared to the non-significant in the previous model. However, we must account for the overdispersion in this model as the Poisson does not include the large variability in our data.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>m2_pois <span class="ot">&lt;-</span> <span class="fu">glm</span>(counts <span class="sc">~</span> treat, <span class="at">data =</span> spiny_counts, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">'log'</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(m2_pois, <span class="at">model.fit =</span> <span class="cn">FALSE</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Observations</td>
<td style="text-align: right;">252</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Dependent variable</td>
<td style="text-align: right;">counts</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Type</td>
<td style="text-align: right;">Generalized linear model</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Family</td>
<td style="text-align: right;">poisson</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Link</td>
<td style="text-align: right;">log</td>
</tr>
</tbody>
</table>
</div>
  
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Est.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S.E.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z val.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">(Intercept)</td>
<td style="text-align: right;">3.12</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">171.74</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">treat</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">8.44</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> Standard errors: MLE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>
</div>
</div>
</div>
<p><strong>e.</strong> Check the model assumptions. Explain results.</p>
<p>Poisson models assume:</p>
<ul>
<li><p>The probabilities of events are independent</p></li>
<li><p>The rate of events is consistent</p></li>
<li><p>The mean and variance are equal</p></li>
</ul>
<p>In real-world count data, counts are not independent (counts are clustered/correlated), rate of events vary in time or space, and variance is often greater than the mean.</p>
<p><strong>f.</strong> Conduct tests for over-dispersion &amp; zero-inflation. Explain results.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(m2_pois)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_overdispersion</span>(m2_pois)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Overdispersion test

       dispersion ratio =    67.033
  Pearson's Chi-Squared = 16758.289
                p-value =   &lt; 0.001</code></pre>
</div>
</div>
<p>Overdispersion is detected, indicating variance &gt; mean, a better model could be fit.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_zeroinflation</span>(m2_pois)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for zero-inflation

   Observed zeros: 27
  Predicted zeros: 0
            Ratio: 0.00</code></pre>
</div>
</div>
<p>Zero-inflation is probable, there are too many zeroes than the model can handle, a better model could be fit.</p>
<p><strong>g.</strong> Fit a negative binomial model using the function glm.nb() from the package <code>MASS</code> and check model diagnostics</p>
<p><strong>h.</strong> In 1-2 sentences explain rationale for fitting this GLM model.</p>
<p>Compared to the Poisson, a NB model adds another parameter that controls the variance so we don‚Äôt have to assume variance = mean.</p>
<p><strong>i.</strong> Interpret the treatment estimate result in your own words. Compare with results from the previous model.</p>
<p>The same treatment coefficient resulted, 0.21, indicating a 23% increase in lobster counts in treatment zones.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS) <span class="do">## </span><span class="al">NOTE</span><span class="do">: The `select()` function is masked. Use: `dplyr::select()` ##</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: The `glm.nb()` function does not require a `family` argument</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>m3_nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(counts <span class="sc">~</span> treat, <span class="at">data =</span> spiny_counts)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(m3_nb)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Observations</td>
<td style="text-align: right;">252</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Dependent variable</td>
<td style="text-align: right;">counts</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Type</td>
<td style="text-align: right;">Generalized linear model</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Family</td>
<td style="text-align: right;">Negative Binomial(0.55)</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Link</td>
<td style="text-align: right;">log</td>
</tr>
</tbody>
</table>
</div>
 
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">ùõò¬≤(250)</td>
<td style="text-align: right;">1.52</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">p</td>
<td style="text-align: right;">0.22</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Pseudo-R¬≤ (Cragg-Uhler)</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Pseudo-R¬≤ (McFadden)</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">AIC</td>
<td style="text-align: right;">2088.53</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">BIC</td>
<td style="text-align: right;">2099.12</td>
</tr>
</tbody>
</table>
</div>
 
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Est.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S.E.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z val.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">(Intercept)</td>
<td style="text-align: right;">3.12</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">26.40</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">treat</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">1.23</td>
<td style="text-align: right;">0.22</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> Standard errors: MLE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_overdispersion</span>(m3_nb)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Overdispersion test

 dispersion ratio = 1.398
          p-value = 0.088</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_zeroinflation</span>(m3_nb)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for zero-inflation

   Observed zeros: 27
  Predicted zeros: 30
            Ratio: 1.12</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_predictions</span>(m3_nb)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(m3_nb)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="step-6-compare-models" class="level4">
<h4 class="anchored" data-anchor-id="step-6-compare-models">Step 6: Compare models</h4>
<p><strong>a.</strong> Use the <code>export_summ()</code> function from the <code>jtools</code> package to look at the three regression models you fit side-by-side.</p>
<p><strong>c.</strong> Write a short paragraph comparing the results. Is the treatment effect <code>robust</code> or stable across the model specifications.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">export_summs</span>(m1_ols, m2_pois, m3_nb,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">model.names =</span> <span class="fu">c</span>(<span class="st">"OLS"</span>,<span class="st">"Poisson"</span>, <span class="st">"NB"</span>),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">statistics =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="huxtable" data-quarto-disable-processing="true" style="margin-left: auto; margin-right: auto;">
<colgroup><col><col><col><col></colgroup><thead>
<tr>
<th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;      font-weight: normal;"></th><th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">OLS</th><th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">Poisson</th><th class="huxtable-cell huxtable-header" style="text-align: center;  border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;      font-weight: normal;">NB</th></tr>
</thead>
<tbody>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">(Intercept)</th><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">22.73 ***</td><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">3.12 ***</td><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;">3.12 ***</td></tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;"></th><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(3.57)&nbsp;&nbsp;&nbsp;</td><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.02)&nbsp;&nbsp;&nbsp;</td><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">(0.12)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;      font-weight: normal;">treat</th><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">5.36&nbsp;&nbsp;&nbsp;&nbsp;</td><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.21 ***</td><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0pt;">0.21&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th class="huxtable-cell huxtable-header" style="border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;      font-weight: normal;"></th><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">(5.20)&nbsp;&nbsp;&nbsp;</td><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">(0.03)&nbsp;&nbsp;&nbsp;</td><td class="huxtable-cell" style="text-align: right;  border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;">(0.17)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th class="huxtable-cell huxtable-header" colspan="4" style="border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;      font-weight: normal;">*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05.</th></tr>
</tbody>
</table>
</div>
</div>
<p>The treatment effect is not stable across our three models. While the estimated effect was somewhat consistent of two models estimating a 23% increase, statistical significance varied greatly. OLS and NB models had a non-significant treatment effect and Poisson had a highly significant effect. This appears to be a false positive of significance from the Poisson due to overdispersion in count data.</p>
<hr>
</section>
<section id="step-7-building-intuition---fixed-effects" class="level4">
<h4 class="anchored" data-anchor-id="step-7-building-intuition---fixed-effects">Step 7: Building intuition - fixed effects</h4>
<p><strong>a.</strong> Create new <code>df</code> with the <code>year</code> variable converted to a factor</p>
<p><strong>b.</strong> Run the following negative binomial model using <code>glm.nb()</code></p>
<ul>
<li>Add fixed effects for <code>year</code> (i.e., dummy coefficients)</li>
<li>Include an interaction term between variables <code>treat</code> &amp; <code>year</code> (<code>treat*year</code>)</li>
</ul>
<p><strong>c.</strong> Take a look at the regression output. Each coefficient provides a comparison or the difference in means for a specific sub-group in the data. Informally, describe the what the model has estimated at a conceptual level (NOTE: you do not have to interpret coefficients individually)</p>
<p>This model also uses a log link like the Poisson, so each coefficient represents multiplicative effects of lobster counts. In this model we also included another predictor, year, which the coefficients represent how counts changed over time. We also have interaction terms between treat and year. This is the additional treatment effect that changes across each year, without it we‚Äôd be assuming that the treatment effect would be constant every year.</p>
<p><strong>d.</strong> Explain why the main effect for treatment is negative? *Does this result make sense?</p>
<p>The treatment coefficient represents how treatment changes our counts in 2012, the negative value indicates that treatment sites had lower counts initially. Interpreting the treatment coefficient in the non-link, treatment sites had a 82% reduction in counts. However, this changes over time past 2012 and treatment counts increased indicated by the positive interaction coefficients.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ff_counts <span class="ot">&lt;-</span> spiny_counts <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year=</span><span class="fu">as_factor</span>(year))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>m5_fixedeffs <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    counts <span class="sc">~</span> treat <span class="sc">+</span> year <span class="sc">+</span> treat<span class="sc">*</span>year,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ff_counts)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summ</span>(m5_fixedeffs, <span class="at">model.fit =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Observations</td>
<td style="text-align: right;">252</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Dependent variable</td>
<td style="text-align: right;">counts</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Type</td>
<td style="text-align: right;">Generalized linear model</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">Family</td>
<td style="text-align: right;">Negative Binomial(0.8129)</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">Link</td>
<td style="text-align: right;">log</td>
</tr>
</tbody>
</table>
</div>
  
<div class="table-responsive">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Est.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">S.E.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">z val.</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">(Intercept)</td>
<td style="text-align: right;">2.35</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">8.89</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">treat</td>
<td style="text-align: right;">-1.72</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">-4.12</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">year2013</td>
<td style="text-align: right;">-0.35</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">-0.93</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">year2014</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.84</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">year2015</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">2.32</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">year2016</td>
<td style="text-align: right;">0.90</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">2.43</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">year2017</td>
<td style="text-align: right;">1.56</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">4.25</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">year2018</td>
<td style="text-align: right;">1.04</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">2.81</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">treat:year2013</td>
<td style="text-align: right;">1.52</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">2.66</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">treat:year2014</td>
<td style="text-align: right;">2.14</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">3.80</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">treat:year2015</td>
<td style="text-align: right;">2.12</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">3.79</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">treat:year2016</td>
<td style="text-align: right;">1.40</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">2.50</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold;">treat:year2017</td>
<td style="text-align: right;">1.55</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">2.77</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold;">treat:year2018</td>
<td style="text-align: right;">2.62</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">4.69</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> Standard errors: MLE</td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
<td style="text-align: right;"></td>
</tr>
</tfoot>

</table>
</div>
</div>
</div>
<p><strong>e.</strong> Look at the model predictions: Use the <code>interact_plot()</code> function from package <code>interactions</code> to plot mean predictions by year and treatment status.</p>
<p><strong>f.</strong> Re-evaluate your responses (c) and (b) above.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interact_plot</span>(m5_fixedeffs, <span class="at">pred =</span> year, <span class="at">modx =</span> treat,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">outcome.scale =</span> <span class="st">"link"</span>) <span class="co"># </span><span class="al">NOTE</span><span class="co">: y-axis on log-scale</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HINT: Change `outcome.scale` to "response" to convert y-axis scale to counts</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">interact_plot</span>(m5_fixedeffs, <span class="at">pred =</span> year, <span class="at">modx =</span> treat,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">outcome.scale =</span> <span class="st">"response"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>g.</strong> Using <code>ggplot()</code> create a plot in same style as the previous <code>interaction plot</code>, but displaying the original scale of the outcome variable (lobster counts). This type of plot is commonly used to show how the treatment effect changes across discrete time points (i.e., panel data).</p>
<p>The plot should have‚Ä¶ - <code>year</code> on the x-axis - <code>counts</code> on the y-axis - <code>mpa</code> as the grouping variable</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint 1: Group counts by `year` and `mpa` and calculate the `mean_count`</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint 2: Convert variable `year` to a factor</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>plot_counts <span class="ot">&lt;-</span> ff_counts <span class="sc">|&gt;</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year, mpa) <span class="sc">|&gt;</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean_count =</span> <span class="fu">mean</span>(counts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>plot_counts <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, mean_count, <span class="at">color =</span> mpa, <span class="at">group =</span> mpa)) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="hw1-lobstrs-eds241_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="step-8-reconsider-causal-identification-assumptions" class="level4">
<h4 class="anchored" data-anchor-id="step-8-reconsider-causal-identification-assumptions">Step 8: Reconsider causal identification assumptions</h4>
<ol type="a">
<li>Discuss whether you think <code>spillover effects</code> are likely in this research context (see Glossary of terms; https://docs.google.com/document/d/1RIudsVcYhWGpqC-Uftk9UTz3PIq6stVyEpT44EPNgpE/edit?usp=sharing)</li>
</ol>
<p>Spillover effects are possible, treatment groups could cause increased counts to spillover into nearby sites as lobsters to walk over to nonmpa sites due to migration or other environmental/behavioral reasons.</p>
<ol start="2" type="a">
<li>Explain why spillover is an issue for the identification of causal effects</li>
</ol>
<p>This is an issue because the control group would also start seeing benefits by the treatment. This defeats the purpose of the control. The outcome of the treatment should not affect the outcome of the control. This makes it more difficult to measure a causal effect.</p>
<ol start="3" type="a">
<li>How does spillover relate to impact in this research setting?</li>
</ol>
<p>If spillover occurs between treatment groups, the causal effect could become obscure to researchers, inhibiting the evaluation of MPAs on lobster counts and size.</p>
<ol start="4" type="a">
<li><p>Discuss the following causal inference assumptions in the context of the MPA treatment effect estimator. Evaluate if each of the assumption are reasonable:</p>
<ol type="1">
<li>SUTVA: Stable Unit Treatment Value assumption</li>
</ol>
<p>The assumptions states that there should be no interference between groups and that all treatment groups receive the same treatment. As stated before spillover is possible in these sites, this first assumption is violated. The second is not however, as all MPAs are under the same regulations.</p>
<ol start="2" type="1">
<li>Excludability assumption</li>
</ol>
<p>The assumption states that only mpa status contributes to the outcome of lobster counts. This is somewhat hard to measure and account for all possible confounders, but for this lter study, seems reasonable.</p></li>
</ol>
<hr>
</section>
</section>
<section id="extra-credit" class="level1">
<h1>EXTRA CREDIT</h1>
<blockquote class="blockquote">
<p>Use the recent lobster abundance data with observations collected up until 2024 (<code>extracredit_sblobstrs24.csv</code>) to run an analysis evaluating the effect of MPA status on lobster counts using the same focal variables.</p>
</blockquote>
<ol type="a">
<li>Create a new script for the analysis on the updated data</li>
<li>Run at least 3 regression models &amp; assess model diagnostics</li>
<li>Compare and contrast results with the analysis from the 2012-2018 data sample (~ 2 paragraphs)</li>
</ol>
<hr>
<p><img src="figures/spiny1.png" class="img-fluid"></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>